generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Agent {
  id            String   @id @default(uuid())
  x402Did       String   @unique @map("x402_did")
  solanaAddress String   @map("solana_address")
  name          String?
  description   String?
  avatar        String?
  reputation    Int      @default(0)
  uptimeHours   Int      @default(0) @map("uptime_hours")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  videos       Video[]
  earnings     Earning[]
  interactions Interaction[]

  @@index([reputation])
  @@index([createdAt])
  @@map("agents")
}

model Video {
  id                String   @id @default(uuid())
  agentId           String   @map("agent_id")
  ipfsCid           String   @map("ipfs_cid")
  title             String?
  description       String?
  thumbnailCid      String?  @map("thumbnail_cid")
  duration          Int      @default(0)
  views             Int      @default(0)
  likes             Int      @default(0)
  forks             Int      @default(0)
  tags              String[] @default([])
  monetizationType  String   @default("free") @map("monetization_type")
  payPerViewAmount  Float?   @map("pay_per_view_amount")
  forkFeeAmount     Float?   @map("fork_fee_amount")
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")

  agent        Agent         @relation(fields: [agentId], references: [id])
  interactions Interaction[]
  comments     Comment[]

  @@index([agentId])
  @@index([createdAt])
  @@index([views])
  @@map("videos")
}

model Interaction {
  id            String   @id @default(uuid())
  videoId       String   @map("video_id")
  agentId       String?  @map("agent_id")
  userType      String   @map("user_type")
  userAddress   String   @map("user_address")
  action        String
  amount        Float?
  txSignature   String?  @map("tx_signature")
  platformFee   Float?   @map("platform_fee")
  createdAt     DateTime @default(now()) @map("created_at")

  video Video? @relation(fields: [videoId], references: [id])
  agent Agent? @relation(fields: [agentId], references: [id])

  @@index([videoId])
  @@index([agentId])
  @@index([createdAt])
  @@map("interactions")
}

model Comment {
  id        String   @id @default(uuid())
  videoId   String   @map("video_id")
  userType  String   @map("user_type")
  userId    String   @map("user_id")
  userName  String   @map("user_name")
  content   String
  likes     Int      @default(0)
  parentId  String?  @map("parent_id")
  createdAt DateTime @default(now()) @map("created_at")

  video Video @relation(fields: [videoId], references: [id])

  @@index([videoId])
  @@index([createdAt])
  @@map("comments")
}

model Like {
  id        String   @id @default(uuid())
  videoId   String   @map("video_id")
  userType  String   @map("user_type")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([videoId, userType, userId])
  @@index([videoId])
  @@index([userId])
  @@map("likes")
}

model Save {
  id        String   @id @default(uuid())
  videoId   String   @map("video_id")
  userType  String   @map("user_type")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([videoId, userType, userId])
  @@index([videoId])
  @@index([userId])
  @@map("saves")
}

model Follow {
  id          String   @id @default(uuid())
  followerType String  @map("follower_type")
  followerId   String  @map("follower_id")
  followingId  String  @map("following_id")
  createdAt    DateTime @default(now()) @map("created_at")

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("follows")
}

model View {
  id        String   @id @default(uuid())
  videoId   String   @map("video_id")
  userType  String?  @map("user_type")
  userId    String?  @map("user_id")
  ipAddress String?  @map("ip_address")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([videoId])
  @@index([createdAt])
  @@map("views")
}

model Earning {
  id          String   @id @default(uuid())
  agentId     String   @map("agent_id")
  type        String
  amount      Float
  fee         Float
  netAmount   Float    @map("net_amount")
  txSignature String   @map("tx_signature")
  createdAt   DateTime @default(now()) @map("created_at")

  agent Agent @relation(fields: [agentId], references: [id])

  @@index([agentId])
  @@index([createdAt])
  @@map("earnings")
}

model PlatformStats {
  id              String   @id @default(uuid())
  totalVideos     Int      @default(0) @map("total_videos")
  totalViews      Int      @default(0) @map("total_views")
  totalTips       Float    @default(0) @map("total_tips")
  totalForks      Int      @default(0) @map("total_forks")
  platformRevenue Float    @default(0) @map("platform_revenue")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("platform_stats")
}
